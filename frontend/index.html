<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excelæ™ºèƒ½åˆ†æç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
            min-height: 600px;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .upload-section.dragover {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .upload-zone {
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-icon {
            font-size: 3em;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .upload-btn:hover {
            background: #45a049;
        }

        .file-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .query-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
        }

        .query-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 120px;
        }

        .query-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .query-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background 0.3s;
        }

        .query-btn:hover {
            background: #1976D2;
        }

        .query-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .response-section {
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            min-height: 300px;
        }

        .response-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin: 10px 0;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin: 10px 0;
        }

        .sample-queries {
            margin-top: 20px;
        }

        .sample-query {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            border: 1px solid #dee2e6;
        }

        .sample-query:hover {
            background: #e3f2fd;
        }

        .workflow-status {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }

        .workflow-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .step-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .step-pending { background: #ccc; }
        .step-running { background: #ff9800; }
        .step-completed { background: #4caf50; }
        .step-error { background: #f44336; }

        .tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š Excelæ™ºèƒ½åˆ†æç³»ç»Ÿ</h1>
            <p>ä¸Šä¼ Excelæ–‡ä»¶ï¼Œä½¿ç”¨AIè¿›è¡Œæ™ºèƒ½æ•°æ®åˆ†æå’Œé—®ç­”</p>
        </div>

        <div class="main-content">
            <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-section" id="uploadSection">
                <div class="upload-zone">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>ä¸Šä¼ Excelæ–‡ä»¶</h3>
                    <p>æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <p style="color: #6c757d; font-size: 14px; margin-top: 10px;">
                        æ”¯æŒæ ¼å¼: .xlsx, .xls, .xlsm (æœ€å¤§50MB)
                    </p>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.xlsm">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    é€‰æ‹©æ–‡ä»¶
                </button>

                <div class="file-info" id="fileInfo">
                    <h4>ğŸ“‹ æ–‡ä»¶ä¿¡æ¯</h4>
                    <div id="fileDetails"></div>
                </div>

                <div class="workflow-status" id="workflowStatus" style="display: none;">
                    <h4>ğŸ”„ å¤„ç†çŠ¶æ€</h4>
                    <div id="workflowSteps"></div>
                </div>
            </div>

            <!-- æŸ¥è¯¢åŒºåŸŸ -->
            <div class="query-section">
                <h3>ğŸ’¬ æ™ºèƒ½é—®ç­”</h3>
                <textarea 
                    class="query-input" 
                    id="queryInput" 
                    placeholder="è¯·è¾“å…¥ä½ æƒ³äº†è§£çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼š&#10;â€¢ è¿™ä¸ªè¡¨æ ¼æœ‰å¤šå°‘è¡Œæ•°æ®ï¼Ÿ&#10;â€¢ é”€å”®é¢æœ€é«˜çš„æœˆä»½æ˜¯å“ªä¸ªï¼Ÿ&#10;â€¢ å¸®æˆ‘åˆ†æä¸€ä¸‹äº§å“ç±»åˆ«çš„åˆ†å¸ƒæƒ…å†µ&#10;â€¢ æ‰¾å‡ºå¼‚å¸¸å€¼æˆ–ç¦»ç¾¤ç‚¹"
                    disabled
                ></textarea>
                
                <button class="query-btn" id="queryBtn" onclick="submitQuery()" disabled>
                    ğŸš€ å¼€å§‹åˆ†æ
                </button>

                <div class="sample-queries">
                    <h4>ğŸ’¡ ç¤ºä¾‹é—®é¢˜</h4>
                    <div class="sample-query" onclick="setQuery('è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªè¡¨æ ¼çš„åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯')">
                        ğŸ“ˆ è¯·å¸®æˆ‘åˆ†æè¿™ä¸ªè¡¨æ ¼çš„åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
                    </div>
                    <div class="sample-query" onclick="setQuery('æ‰¾å‡ºæ•°æ®ä¸­çš„å¼‚å¸¸å€¼å’Œç¦»ç¾¤ç‚¹')">
                        ğŸ” æ‰¾å‡ºæ•°æ®ä¸­çš„å¼‚å¸¸å€¼å’Œç¦»ç¾¤ç‚¹
                    </div>
                    <div class="sample-query" onclick="setQuery('å„ä¸ªæ•°å€¼åˆ—ä¹‹é—´æœ‰ä»€ä¹ˆå…³è”å…³ç³»ï¼Ÿ')">
                        ğŸ”— å„ä¸ªæ•°å€¼åˆ—ä¹‹é—´æœ‰ä»€ä¹ˆå…³è”å…³ç³»ï¼Ÿ
                    </div>
                    <div class="sample-query" onclick="setQuery('ç”Ÿæˆä¸€ä¸ªæ•°æ®å¯è§†åŒ–å›¾è¡¨')">
                        ğŸ“Š ç”Ÿæˆä¸€ä¸ªæ•°æ®å¯è§†åŒ–å›¾è¡¨
                    </div>
                </div>
            </div>
        </div>

        <!-- å“åº”åŒºåŸŸ -->
        <div class="response-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('response')">ğŸ“‹ åˆ†æç»“æœ</button>
                <button class="tab" onclick="switchTab('data')">ğŸ“Š æ•°æ®é¢„è§ˆ</button>
                <button class="tab" onclick="switchTab('code')">ğŸ’» ç”Ÿæˆä»£ç </button>
            </div>

            <div id="responseTab" class="tab-content active">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>AIæ­£åœ¨åˆ†æä¸­ï¼Œè¯·ç¨å€™...</p>
                </div>
                <div class="response-content" id="responseContent">
                    ğŸ‘‹ æ¬¢è¿ä½¿ç”¨Excelæ™ºèƒ½åˆ†æç³»ç»Ÿï¼
                    
è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤å¼€å§‹ï¼š
1. ä¸Šä¼ æ‚¨çš„Excelæ–‡ä»¶
2. ç­‰å¾…æ–‡ä»¶å¤„ç†å®Œæˆ
3. åœ¨å³ä¾§è¾“å…¥æ‚¨çš„é—®é¢˜
4. ç‚¹å‡»"å¼€å§‹åˆ†æ"è·å¾—AIå›å¤

ç³»ç»Ÿæ”¯æŒï¼š
â€¢ ğŸ“Š æ•°æ®ç»Ÿè®¡åˆ†æ
â€¢ ğŸ” å¼‚å¸¸å€¼æ£€æµ‹
â€¢ ğŸ“ˆ è¶‹åŠ¿åˆ†æ
â€¢ ğŸ“‹ æ•°æ®æ¸…æ´—å»ºè®®
â€¢ ğŸ¨ å¯è§†åŒ–å›¾è¡¨ç”Ÿæˆ
                </div>
            </div>

            <div id="dataTab" class="tab-content">
                <div id="dataPreview">
                    <p>ä¸Šä¼ æ–‡ä»¶åå°†æ˜¾ç¤ºæ•°æ®é¢„è§ˆ...</p>
                </div>
            </div>

            <div id="codeTab" class="tab-content">
                <div id="generatedCode">
                    <p>åˆ†æå®Œæˆåå°†æ˜¾ç¤ºç”Ÿæˆçš„Pythonä»£ç ...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedFile = null;
        let fileProcessed = false;

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const queryInput = document.getElementById('queryInput');
        const queryBtn = document.getElementById('queryBtn');

        // æ‹–æ‹½ä¸Šä¼ 
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // éªŒè¯æ–‡ä»¶ç±»å‹
            const allowedTypes = ['.xlsx', '.xls', '.xlsm'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showError('è¯·ä¸Šä¼ Excelæ–‡ä»¶ (.xlsx, .xls, .xlsm)');
                return;
            }

            // éªŒè¯æ–‡ä»¶å¤§å° (50MB)
            if (file.size > 50 * 1024 * 1024) {
                showError('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB');
                return;
            }

            uploadedFile = file;
            displayFileInfo(file);
            uploadFile(file);
        }

        function displayFileInfo(file) {
            const sizeInMB = (file.size / 1024 / 1024).toFixed(2);
            fileDetails.innerHTML = `
                <p><strong>æ–‡ä»¶å:</strong> ${file.name}</p>
                <p><strong>å¤§å°:</strong> ${sizeInMB} MB</p>
                <p><strong>ç±»å‹:</strong> ${file.type}</p>
                <p><strong>æœ€åä¿®æ”¹:</strong> ${new Date(file.lastModified).toLocaleString()}</p>
            `;
            fileInfo.classList.add('show');
        }

        async function uploadFile(file) {
            const workflowStatus = document.getElementById('workflowStatus');
            const workflowSteps = document.getElementById('workflowSteps');
            
            workflowStatus.style.display = 'block';
            
            // æ˜¾ç¤ºå¤„ç†æ­¥éª¤
            const steps = [
                { id: 'upload', name: 'ğŸ“¤ æ–‡ä»¶ä¸Šä¼ ' },
                { id: 'ingest', name: 'ğŸ“Š æ–‡ä»¶è§£æ' },
                { id: 'profile', name: 'ğŸ” æ•°æ®åˆ†æ' },
                { id: 'ready', name: 'âœ… å‡†å¤‡å°±ç»ª' }
            ];

            workflowSteps.innerHTML = steps.map(step => 
                `<div class="workflow-step">
                    <div class="step-status step-pending" id="status-${step.id}"></div>
                    <span>${step.name}</span>
                </div>`
            ).join('');

            try {
                // æ¨¡æ‹Ÿæ–‡ä»¶å¤„ç†æµç¨‹
                await simulateStep('upload', 1000);
                await simulateStep('ingest', 2000);
                await simulateStep('profile', 1500);
                await simulateStep('ready', 500);

                fileProcessed = true;
                queryInput.disabled = false;
                queryBtn.disabled = false;
                
                showSuccess('æ–‡ä»¶å¤„ç†å®Œæˆï¼ç°åœ¨å¯ä»¥å¼€å§‹æé—®äº†ã€‚');
                
                // æ¨¡æ‹Ÿæ•°æ®é¢„è§ˆ
                displayDataPreview();
                
            } catch (error) {
                showError('æ–‡ä»¶å¤„ç†å¤±è´¥: ' + error.message);
                setStepStatus('upload', 'error');
            }
        }

        async function simulateStep(stepId, delay) {
            setStepStatus(stepId, 'running');
            await new Promise(resolve => setTimeout(resolve, delay));
            setStepStatus(stepId, 'completed');
        }

        function setStepStatus(stepId, status) {
            const element = document.getElementById(`status-${stepId}`);
            element.className = `step-status step-${status}`;
        }

        function displayDataPreview() {
            // æ¨¡æ‹Ÿæ•°æ®é¢„è§ˆ
            const dataPreview = document.getElementById('dataPreview');
            dataPreview.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <h4>ğŸ“Š æ•°æ®é¢„è§ˆ - ${uploadedFile.name}</h4>
                    <div style="overflow-x: auto; margin-top: 15px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 10px; border: 1px solid #ddd;">äº§å“åç§°</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">é”€å”®é¢</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">æ•°é‡</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">æ—¥æœŸ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">ç¬”è®°æœ¬ç”µè„‘</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">15000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">5</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-15</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">æ‰‹æœº</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">8000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">10</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-16</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">å¹³æ¿ç”µè„‘</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">6000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">8</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-17</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p style="margin-top: 15px; color: #6c757d;">
                        <strong>æ•°æ®æ¦‚è§ˆ:</strong> å…±3è¡Œæ•°æ®ï¼Œ4ä¸ªå­—æ®µ
                    </p>
                </div>
            `;
        }

        async function submitQuery() {
            const query = queryInput.value.trim();
            if (!query) {
                showError('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜');
                return;
            }

            if (!fileProcessed) {
                showError('è¯·å…ˆä¸Šä¼ å¹¶å¤„ç†Excelæ–‡ä»¶');
                return;
            }

            const loading = document.getElementById('loading');
            const responseContent = document.getElementById('responseContent');
            
            loading.classList.add('show');
            responseContent.style.display = 'none';
            queryBtn.disabled = true;

            try {
                // æ¨¡æ‹ŸAPIè°ƒç”¨
                const response = await simulateAnalysis(query);
                
                loading.classList.remove('show');
                responseContent.style.display = 'block';
                responseContent.textContent = response.analysis;

                // æ˜¾ç¤ºç”Ÿæˆçš„ä»£ç 
                document.getElementById('generatedCode').innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4>ğŸ’» ç”Ÿæˆçš„Pythonä»£ç </h4>
                        <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>${response.code}</code></pre>
                    </div>
                `;

                queryBtn.disabled = false;
                
            } catch (error) {
                loading.classList.remove('show');
                showError('åˆ†æå¤±è´¥: ' + error.message);
                queryBtn.disabled = false;
            }
        }

        async function simulateAnalysis(query) {
            // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
            await new Promise(resolve => setTimeout(resolve, 3000));

            // æ¨¡æ‹Ÿä¸åŒç±»å‹çš„å›å¤
            let analysis = '';
            let code = '';

            if (query.includes('ç»Ÿè®¡') || query.includes('åŸºæœ¬ä¿¡æ¯')) {
                analysis = `ğŸ“Š æ•°æ®ç»Ÿè®¡åˆ†æç»“æœ

åŸºäºæ‚¨ä¸Šä¼ çš„Excelæ–‡ä»¶ï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹ç»Ÿè®¡åˆ†æï¼š

ğŸ“‹ æ•°æ®æ¦‚è§ˆï¼š
â€¢ æ€»è¡Œæ•°: 1,234 è¡Œ
â€¢ æ€»åˆ—æ•°: 8 åˆ—
â€¢ æ•°æ®ç±»å‹: 4ä¸ªæ•°å€¼åˆ—, 3ä¸ªæ–‡æœ¬åˆ—, 1ä¸ªæ—¥æœŸåˆ—

ğŸ“ˆ æ•°å€¼åˆ—ç»Ÿè®¡ï¼š
â€¢ é”€å”®é¢: å¹³å‡å€¼ Â¥8,547, æœ€å¤§å€¼ Â¥25,000, æœ€å°å€¼ Â¥1,200
â€¢ æ•°é‡: å¹³å‡å€¼ 15.6, æœ€å¤§å€¼ 100, æœ€å°å€¼ 1
â€¢ åˆ©æ¶¦ç‡: å¹³å‡å€¼ 23.4%, æ ‡å‡†å·® 8.9%

ğŸ” æ•°æ®è´¨é‡ï¼š
â€¢ å®Œæ•´æ€§: 98.7% (16ä¸ªç¼ºå¤±å€¼)
â€¢ é‡å¤è®°å½•: 3æ¡
â€¢ å¼‚å¸¸å€¼: åœ¨é”€å”®é¢åˆ—å‘ç°5ä¸ªæ½œåœ¨å¼‚å¸¸å€¼

ğŸ’¡ å…³é”®æ´å¯Ÿï¼š
1. ç”µå­äº§å“ç±»åˆ«é”€å”®é¢å æ€»é”€å”®é¢çš„68%
2. Q4é”€å”®é¢æ¯”Q3å¢é•¿äº†15.3%
3. å‘¨äº”å’Œå‘¨å…­æ˜¯é”€å”®é«˜å³°æœŸ

å»ºè®®è¿›ä¸€æ­¥åˆ†æäº§å“ç±»åˆ«åˆ†å¸ƒå’Œå­£èŠ‚æ€§è¶‹åŠ¿ã€‚`;

                code = `import pandas as pd
import numpy as np

# è¯»å–æ•°æ®
df = pd.read_excel('${uploadedFile.name}')

# åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
print("æ•°æ®å½¢çŠ¶:", df.shape)
print("\\næ•°æ®ç±»å‹:")
print(df.dtypes)

# æ•°å€¼åˆ—ç»Ÿè®¡
numeric_cols = df.select_dtypes(include=[np.number]).columns
print("\\næ•°å€¼åˆ—ç»Ÿè®¡:")
print(df[numeric_cols].describe())

# ç¼ºå¤±å€¼æ£€æŸ¥
print("\\nç¼ºå¤±å€¼ç»Ÿè®¡:")
print(df.isnull().sum())`;

            } else if (query.includes('å¼‚å¸¸') || query.includes('ç¦»ç¾¤ç‚¹')) {
                analysis = `ğŸ” å¼‚å¸¸å€¼å’Œç¦»ç¾¤ç‚¹æ£€æµ‹ç»“æœ

æˆ‘ä½¿ç”¨å¤šç§ç»Ÿè®¡æ–¹æ³•æ£€æµ‹äº†æ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼š

ğŸ“Š æ£€æµ‹æ–¹æ³•ï¼š
1. IQRæ–¹æ³• (å››åˆ†ä½è·)
2. Z-Scoreæ–¹æ³• (æ ‡å‡†åŒ–å¾—åˆ†)
3. éš”ç¦»æ£®æ—ç®—æ³•

ğŸš¨ å‘ç°çš„å¼‚å¸¸å€¼ï¼š

é”€å”®é¢åˆ— (5ä¸ªå¼‚å¸¸å€¼):
â€¢ ç¬¬67è¡Œ: Â¥87,500 (Z-score: 4.2)
â€¢ ç¬¬156è¡Œ: Â¥0 (å¯èƒ½æ˜¯æ•°æ®å½•å…¥é”™è¯¯)
â€¢ ç¬¬234è¡Œ: Â¥125,000 (Z-score: 6.8)
â€¢ ç¬¬445è¡Œ: Â¥-2,500 (è´Ÿæ•°é”€å”®é¢ï¼Œéœ€è¦éªŒè¯)
â€¢ ç¬¬789è¡Œ: Â¥99,999 (Z-score: 5.1)

æ•°é‡åˆ— (2ä¸ªå¼‚å¸¸å€¼):
â€¢ ç¬¬123è¡Œ: 999 (å¯èƒ½æ˜¯æ‰¹å‘è®¢å•)
â€¢ ç¬¬567è¡Œ: 0 (é›¶æ•°é‡ä½†æœ‰é”€å”®é¢)

ğŸ’¡ å»ºè®®å¤„ç†æ–¹æ¡ˆï¼š
1. è´Ÿæ•°é”€å”®é¢: éœ€è¦æ•°æ®æºéªŒè¯
2. æå¤§å€¼: ç¡®è®¤æ˜¯å¦ä¸ºæ­£å¸¸çš„å¤§è®¢å•
3. é›¶å€¼å¼‚å¸¸: æ£€æŸ¥æ•°æ®å½•å…¥é€»è¾‘

æ˜¯å¦éœ€è¦æˆ‘ç”Ÿæˆæ•°æ®æ¸…æ´—ä»£ç ï¼Ÿ`;

                code = `import pandas as pd
import numpy as np
from scipy import stats

# å¼‚å¸¸å€¼æ£€æµ‹å‡½æ•°
def detect_outliers_iqr(df, column):
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    
    outliers = df[(df[column] < lower_bound) | (df[column] > upper_bound)]
    return outliers

def detect_outliers_zscore(df, column, threshold=3):
    z_scores = np.abs(stats.zscore(df[column]))
    outliers = df[z_scores > threshold]
    return outliers

# æ£€æµ‹é”€å”®é¢å¼‚å¸¸å€¼
sales_outliers_iqr = detect_outliers_iqr(df, 'sales_amount')
sales_outliers_zscore = detect_outliers_zscore(df, 'sales_amount')

print(f"IQRæ–¹æ³•æ£€æµ‹åˆ° {len(sales_outliers_iqr)} ä¸ªå¼‚å¸¸å€¼")
print(f"Z-Scoreæ–¹æ³•æ£€æµ‹åˆ° {len(sales_outliers_zscore)} ä¸ªå¼‚å¸¸å€¼")`;

            } else if (query.includes('å…³è”') || query.includes('ç›¸å…³æ€§')) {
                analysis = `ğŸ”— æ•°æ®å…³è”å…³ç³»åˆ†æ

é€šè¿‡ç›¸å…³æ€§åˆ†æï¼Œæˆ‘å‘ç°äº†ä»¥ä¸‹æœ‰è¶£çš„æ•°æ®å…³è”ï¼š

ğŸ“ˆ å¼ºæ­£ç›¸å…³å…³ç³» (r > 0.7):
â€¢ é”€å”®é¢ â†” åˆ©æ¶¦é¢: r = 0.89 (é«˜åº¦ç›¸å…³)
â€¢ äº§å“ä»·æ ¼ â†” åˆ©æ¶¦ç‡: r = 0.76 (å¼ºç›¸å…³)
â€¢ å¹¿å‘ŠæŠ•å…¥ â†” é”€å”®é¢: r = 0.72 (å¼ºç›¸å…³)

ğŸ“‰ è´Ÿç›¸å…³å…³ç³» (r < -0.3):
â€¢ æŠ˜æ‰£ç‡ â†” åˆ©æ¶¦ç‡: r = -0.65 (ä¸­åº¦è´Ÿç›¸å…³)
â€¢ åº“å­˜é‡ â†” é”€å”®é€Ÿåº¦: r = -0.45 (ä¸­åº¦è´Ÿç›¸å…³)

ğŸ” æœ‰è¶£çš„å‘ç°ï¼š
1. é”€å”®é¢å’Œåˆ©æ¶¦é¢é«˜åº¦ç›¸å…³ï¼Œè¯´æ˜å®šä»·ç­–ç•¥è¾ƒä¸ºç¨³å®š
2. å¹¿å‘ŠæŠ•å…¥ä¸é”€å”®é¢å‘ˆå¼ºæ­£ç›¸å…³ï¼ŒæŠ•èµ„å›æŠ¥æ˜æ˜¾
3. æŠ˜æ‰£ç‡è¿‡é«˜ä¼šæ˜¾è‘—å½±å“åˆ©æ¶¦ç‡

ğŸ“Š å»ºè®®ï¼š
â€¢ ä¼˜åŒ–æŠ˜æ‰£ç­–ç•¥ï¼Œå¹³è¡¡é”€é‡å’Œåˆ©æ¶¦
â€¢ ç»§ç»­ä¿æŒå¹¿å‘ŠæŠ•å…¥ï¼ŒROIè‰¯å¥½
â€¢ å…³æ³¨åº“å­˜å‘¨è½¬ç‡ï¼Œå‡å°‘ç§¯å‹

éœ€è¦æˆ‘ç”Ÿæˆç›¸å…³æ€§çƒ­åŠ›å›¾å—ï¼Ÿ`;

                code = `import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# è®¡ç®—ç›¸å…³æ€§çŸ©é˜µ
numeric_cols = df.select_dtypes(include=[np.number]).columns
correlation_matrix = df[numeric_cols].corr()

# åˆ›å»ºçƒ­åŠ›å›¾
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, 
            annot=True, 
            cmap='coolwarm', 
            center=0,
            square=True)
plt.title('æ•°æ®ç›¸å…³æ€§çƒ­åŠ›å›¾')
plt.tight_layout()
plt.show()

# æ‰¾å‡ºå¼ºç›¸å…³å…³ç³»
def find_high_correlations(corr_matrix, threshold=0.7):
    high_corr_pairs = []
    for i in range(len(corr_matrix.columns)):
        for j in range(i+1, len(corr_matrix.columns)):
            if abs(corr_matrix.iloc[i, j]) > threshold:
                high_corr_pairs.append({
                    'var1': corr_matrix.columns[i],
                    'var2': corr_matrix.columns[j],
                    'correlation': corr_matrix.iloc[i, j]
                })
    return high_corr_pairs

high_correlations = find_high_correlations(correlation_matrix)
print("å¼ºç›¸å…³å…³ç³»:")
for pair in high_correlations:
    print(f"{pair['var1']} - {pair['var2']}: {pair['correlation']:.3f}")`;

            } else if (query.includes('å›¾è¡¨') || query.includes('å¯è§†åŒ–')) {
                analysis = `ğŸ“Š æ•°æ®å¯è§†åŒ–åˆ†æ

æˆ‘ä¸ºæ‚¨çš„æ•°æ®åˆ›å»ºäº†å¤šç§å¯è§†åŒ–å›¾è¡¨ï¼š

ğŸ¨ ç”Ÿæˆçš„å›¾è¡¨åŒ…æ‹¬ï¼š

1. ğŸ“ˆ é”€å”®è¶‹åŠ¿çº¿å›¾
   â€¢ æ˜¾ç¤ºæœˆåº¦é”€å”®é¢å˜åŒ–è¶‹åŠ¿
   â€¢ å‘ç°æ˜æ˜¾çš„å­£èŠ‚æ€§æ¨¡å¼
   â€¢ Q4é”€å”®é¢è¾¾åˆ°å³°å€¼

2. ğŸ“Š äº§å“ç±»åˆ«åˆ†å¸ƒé¥¼å›¾
   â€¢ ç”µå­äº§å“: 45%
   â€¢ æœè£…: 28%
   â€¢ å®¶å±…: 18%
   â€¢ å…¶ä»–: 9%

3. ğŸ“‹ é”€å”®é¢åˆ†å¸ƒç›´æ–¹å›¾
   â€¢ å¤§éƒ¨åˆ†è®¢å•é›†ä¸­åœ¨Â¥1,000-Â¥5,000åŒºé—´
   â€¢ é•¿å°¾åˆ†å¸ƒï¼Œå°‘æ•°å¤§è®¢å•æ‹‰é«˜äº†å‡å€¼

4. ğŸ”¥ ç›¸å…³æ€§çƒ­åŠ›å›¾
   â€¢ æ­ç¤ºäº†å˜é‡é—´çš„ç›¸äº’å…³ç³»
   â€¢ å¸®åŠ©ç†è§£ä¸šåŠ¡é©±åŠ¨å› ç´ 

ğŸ’¡ å¯è§†åŒ–æ´å¯Ÿï¼š
â€¢ é”€å”®é¢å‘ˆç°æ˜æ˜¾çš„å­£èŠ‚æ€§è§„å¾‹
â€¢ äº§å“ç±»åˆ«åˆ†å¸ƒä¸å‡åŒ€ï¼Œå¯è€ƒè™‘ä¼˜åŒ–äº§å“ç»„åˆ
â€¢ å¤§éƒ¨åˆ†å®¢æˆ·ä¸ºä¸­å°é¢æ¶ˆè´¹è€…

æ‰€æœ‰å›¾è¡¨å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œæ‚¨å¯ä»¥ç›´æ¥ç”¨äºæŠ¥å‘Šä¸­ã€‚`;

                code = `import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
plt.rcParams['font.sans-serif'] = ['SimHei']

# è®¾ç½®å›¾è¡¨æ ·å¼
plt.style.use('seaborn')

# 1. é”€å”®è¶‹åŠ¿çº¿å›¾
fig, axes = plt.subplots(2, 2, figsize=(15, 12))

# æœˆåº¦é”€å”®è¶‹åŠ¿
monthly_sales = df.groupby('month')['sales_amount'].sum()
axes[0,0].plot(monthly_sales.index, monthly_sales.values, marker='o')
axes[0,0].set_title('æœˆåº¦é”€å”®è¶‹åŠ¿')
axes[0,0].set_xlabel('æœˆä»½')
axes[0,0].set_ylabel('é”€å”®é¢')

# 2. äº§å“ç±»åˆ«åˆ†å¸ƒé¥¼å›¾
category_dist = df['category'].value_counts()
axes[0,1].pie(category_dist.values, labels=category_dist.index, autopct='%1.1f%%')
axes[0,1].set_title('äº§å“ç±»åˆ«åˆ†å¸ƒ')

# 3. é”€å”®é¢åˆ†å¸ƒç›´æ–¹å›¾
axes[1,0].hist(df['sales_amount'], bins=30, alpha=0.7)
axes[1,0].set_title('é”€å”®é¢åˆ†å¸ƒ')
axes[1,0].set_xlabel('é”€å”®é¢')
axes[1,0].set_ylabel('é¢‘æ¬¡')

# 4. ç›¸å…³æ€§çƒ­åŠ›å›¾
corr = df.select_dtypes(include=[np.number]).corr()
sns.heatmap(corr, annot=True, cmap='coolwarm', ax=axes[1,1])
axes[1,1].set_title('ç›¸å…³æ€§çƒ­åŠ›å›¾')

plt.tight_layout()
plt.savefig('æ•°æ®åˆ†æå›¾è¡¨.png', dpi=300, bbox_inches='tight')
plt.show()`;

            } else {
                analysis = `ğŸ¤– AIæ™ºèƒ½åˆ†æå›å¤

æ„Ÿè°¢æ‚¨çš„æé—®ï¼åŸºäºæ‚¨ä¸Šä¼ çš„Excelæ–‡ä»¶ï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹åˆ†æï¼š

ğŸ“Š æ•°æ®æ¦‚å†µï¼š
æ‚¨çš„æ–‡ä»¶åŒ…å« ${uploadedFile.name}ï¼Œæˆ‘å·²ç»å®Œæˆäº†åˆæ­¥çš„æ•°æ®è§£æå’Œç»“æ„åˆ†æã€‚

ğŸ” é’ˆå¯¹æ‚¨çš„é—®é¢˜ï¼š"${query}"

æˆ‘å»ºè®®ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦è¿›è¡Œåˆ†æï¼š

1. ğŸ“ˆ æ•°æ®ç»Ÿè®¡ï¼šåŸºæœ¬çš„æè¿°æ€§ç»Ÿè®¡ä¿¡æ¯
2. ğŸ” æ•°æ®è´¨é‡ï¼šæ£€æŸ¥ç¼ºå¤±å€¼ã€é‡å¤å€¼ã€å¼‚å¸¸å€¼
3. ğŸ“Š æ•°æ®åˆ†å¸ƒï¼šäº†è§£å„å­—æ®µçš„åˆ†å¸ƒç‰¹å¾
4. ğŸ”— å…³è”åˆ†æï¼šæ¢ç´¢å˜é‡é—´çš„ç›¸å…³å…³ç³»
5. ğŸ¯ ä¸šåŠ¡æ´å¯Ÿï¼šç»“åˆä¸šåŠ¡èƒŒæ™¯æä¾›å»ºè®®

ğŸ’¡ å¦‚éœ€æ›´å…·ä½“çš„åˆ†æï¼Œè¯·å°è¯•ä»¥ä¸‹é—®é¢˜ï¼š
â€¢ "å¸®æˆ‘åˆ†ææ•°æ®çš„åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯"
â€¢ "æ£€æµ‹æ•°æ®ä¸­çš„å¼‚å¸¸å€¼"
â€¢ "åˆ†æå„åˆ—ä¹‹é—´çš„ç›¸å…³æ€§"
â€¢ "ç”Ÿæˆæ•°æ®å¯è§†åŒ–å›¾è¡¨"

æˆ‘éšæ—¶å‡†å¤‡ä¸ºæ‚¨æä¾›æ›´è¯¦ç»†çš„åˆ†æï¼`;

                code = `import pandas as pd
import numpy as np

# è¯»å–Excelæ–‡ä»¶
df = pd.read_excel('${uploadedFile.name}')

# åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹
print("æ•°æ®åŸºæœ¬ä¿¡æ¯:")
print(f"è¡Œæ•°: {df.shape[0]}")
print(f"åˆ—æ•°: {df.shape[1]}")
print(f"\\nåˆ—å: {list(df.columns)}")

# æ•°æ®ç±»å‹
print("\\næ•°æ®ç±»å‹:")
print(df.dtypes)

# å‰5è¡Œæ•°æ®é¢„è§ˆ
print("\\næ•°æ®é¢„è§ˆ:")
print(df.head())

# å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šåˆ†æ...`;
            }

            return { analysis, code };
        }

        function setQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾å†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„activeçŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾å†…å®¹
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // è®¾ç½®é€‰ä¸­æ ‡ç­¾çš„activeçŠ¶æ€
            event.target.classList.add('active');
        }

        function showError(message) {
            const responseContent = document.getElementById('responseContent');
            responseContent.innerHTML = `<div class="error">âŒ ${message}</div>`;
            responseContent.style.display = 'block';
        }

        function showSuccess(message) {
            const responseContent = document.getElementById('responseContent');
            responseContent.innerHTML = `<div class="success">âœ… ${message}</div>`;
            responseContent.style.display = 'block';
        }
    </script>
</body>
</html>