<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel智能分析系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
            min-height: 600px;
        }

        .upload-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .upload-section.dragover {
            border-color: #4CAF50;
            background: #e8f5e9;
        }

        .upload-zone {
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-icon {
            font-size: 3em;
            color: #6c757d;
            margin-bottom: 15px;
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .upload-btn:hover {
            background: #45a049;
        }

        .file-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .query-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
        }

        .query-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 15px;
            resize: vertical;
            min-height: 120px;
        }

        .query-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .query-btn {
            background: #2196F3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background 0.3s;
        }

        .query-btn:hover {
            background: #1976D2;
        }

        .query-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .response-section {
            grid-column: 1 / -1;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            min-height: 300px;
        }

        .response-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #4CAF50;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            margin: 10px 0;
        }

        .success {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4caf50;
            margin: 10px 0;
        }

        .sample-queries {
            margin-top: 20px;
        }

        .sample-query {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
            border: 1px solid #dee2e6;
        }

        .sample-query:hover {
            background: #e3f2fd;
        }

        .workflow-status {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }

        .workflow-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
        }

        .step-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .step-pending { background: #ccc; }
        .step-running { background: #ff9800; }
        .step-completed { background: #4caf50; }
        .step-error { background: #f44336; }

        .tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: #6c757d;
            transition: all 0.3s;
        }

        .tab.active {
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 Excel智能分析系统</h1>
            <p>上传Excel文件，使用AI进行智能数据分析和问答</p>
        </div>

        <div class="main-content">
            <!-- 文件上传区域 -->
            <div class="upload-section" id="uploadSection">
                <div class="upload-zone">
                    <div class="upload-icon">📁</div>
                    <h3>上传Excel文件</h3>
                    <p>拖拽文件到这里或点击选择文件</p>
                    <p style="color: #6c757d; font-size: 14px; margin-top: 10px;">
                        支持格式: .xlsx, .xls, .xlsm (最大50MB)
                    </p>
                </div>
                
                <input type="file" id="fileInput" class="file-input" accept=".xlsx,.xls,.xlsm">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    选择文件
                </button>

                <div class="file-info" id="fileInfo">
                    <h4>📋 文件信息</h4>
                    <div id="fileDetails"></div>
                </div>

                <div class="workflow-status" id="workflowStatus" style="display: none;">
                    <h4>🔄 处理状态</h4>
                    <div id="workflowSteps"></div>
                </div>
            </div>

            <!-- 查询区域 -->
            <div class="query-section">
                <h3>💬 智能问答</h3>
                <textarea 
                    class="query-input" 
                    id="queryInput" 
                    placeholder="请输入你想了解的问题，例如：&#10;• 这个表格有多少行数据？&#10;• 销售额最高的月份是哪个？&#10;• 帮我分析一下产品类别的分布情况&#10;• 找出异常值或离群点"
                    disabled
                ></textarea>
                
                <button class="query-btn" id="queryBtn" onclick="submitQuery()" disabled>
                    🚀 开始分析
                </button>

                <div class="sample-queries">
                    <h4>💡 示例问题</h4>
                    <div class="sample-query" onclick="setQuery('请帮我分析这个表格的基本统计信息')">
                        📈 请帮我分析这个表格的基本统计信息
                    </div>
                    <div class="sample-query" onclick="setQuery('找出数据中的异常值和离群点')">
                        🔍 找出数据中的异常值和离群点
                    </div>
                    <div class="sample-query" onclick="setQuery('各个数值列之间有什么关联关系？')">
                        🔗 各个数值列之间有什么关联关系？
                    </div>
                    <div class="sample-query" onclick="setQuery('生成一个数据可视化图表')">
                        📊 生成一个数据可视化图表
                    </div>
                </div>
            </div>
        </div>

        <!-- 响应区域 -->
        <div class="response-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('response')">📋 分析结果</button>
                <button class="tab" onclick="switchTab('data')">📊 数据预览</button>
                <button class="tab" onclick="switchTab('code')">💻 生成代码</button>
            </div>

            <div id="responseTab" class="tab-content active">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>AI正在分析中，请稍候...</p>
                </div>
                <div class="response-content" id="responseContent">
                    👋 欢迎使用Excel智能分析系统！
                    
请按以下步骤开始：
1. 上传您的Excel文件
2. 等待文件处理完成
3. 在右侧输入您的问题
4. 点击"开始分析"获得AI回复

系统支持：
• 📊 数据统计分析
• 🔍 异常值检测
• 📈 趋势分析
• 📋 数据清洗建议
• 🎨 可视化图表生成
                </div>
            </div>

            <div id="dataTab" class="tab-content">
                <div id="dataPreview">
                    <p>上传文件后将显示数据预览...</p>
                </div>
            </div>

            <div id="codeTab" class="tab-content">
                <div id="generatedCode">
                    <p>分析完成后将显示生成的Python代码...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let uploadedFile = null;
        let fileProcessed = false;

        // 文件上传处理
        const uploadSection = document.getElementById('uploadSection');
        const fileInput = document.getElementById('fileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileDetails = document.getElementById('fileDetails');
        const queryInput = document.getElementById('queryInput');
        const queryBtn = document.getElementById('queryBtn');

        // 拖拽上传
        uploadSection.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadSection.classList.add('dragover');
        });

        uploadSection.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
        });

        uploadSection.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadSection.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            // 验证文件类型
            const allowedTypes = ['.xlsx', '.xls', '.xlsm'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                showError('请上传Excel文件 (.xlsx, .xls, .xlsm)');
                return;
            }

            // 验证文件大小 (50MB)
            if (file.size > 50 * 1024 * 1024) {
                showError('文件大小不能超过50MB');
                return;
            }

            uploadedFile = file;
            displayFileInfo(file);
            uploadFile(file);
        }

        function displayFileInfo(file) {
            const sizeInMB = (file.size / 1024 / 1024).toFixed(2);
            fileDetails.innerHTML = `
                <p><strong>文件名:</strong> ${file.name}</p>
                <p><strong>大小:</strong> ${sizeInMB} MB</p>
                <p><strong>类型:</strong> ${file.type}</p>
                <p><strong>最后修改:</strong> ${new Date(file.lastModified).toLocaleString()}</p>
            `;
            fileInfo.classList.add('show');
        }

        async function uploadFile(file) {
            const workflowStatus = document.getElementById('workflowStatus');
            const workflowSteps = document.getElementById('workflowSteps');
            
            workflowStatus.style.display = 'block';
            
            // 显示处理步骤
            const steps = [
                { id: 'upload', name: '📤 文件上传' },
                { id: 'ingest', name: '📊 文件解析' },
                { id: 'profile', name: '🔍 数据分析' },
                { id: 'ready', name: '✅ 准备就绪' }
            ];

            workflowSteps.innerHTML = steps.map(step => 
                `<div class="workflow-step">
                    <div class="step-status step-pending" id="status-${step.id}"></div>
                    <span>${step.name}</span>
                </div>`
            ).join('');

            try {
                // 模拟文件处理流程
                await simulateStep('upload', 1000);
                await simulateStep('ingest', 2000);
                await simulateStep('profile', 1500);
                await simulateStep('ready', 500);

                fileProcessed = true;
                queryInput.disabled = false;
                queryBtn.disabled = false;
                
                showSuccess('文件处理完成！现在可以开始提问了。');
                
                // 模拟数据预览
                displayDataPreview();
                
            } catch (error) {
                showError('文件处理失败: ' + error.message);
                setStepStatus('upload', 'error');
            }
        }

        async function simulateStep(stepId, delay) {
            setStepStatus(stepId, 'running');
            await new Promise(resolve => setTimeout(resolve, delay));
            setStepStatus(stepId, 'completed');
        }

        function setStepStatus(stepId, status) {
            const element = document.getElementById(`status-${stepId}`);
            element.className = `step-status step-${status}`;
        }

        function displayDataPreview() {
            // 模拟数据预览
            const dataPreview = document.getElementById('dataPreview');
            dataPreview.innerHTML = `
                <div style="background: white; padding: 15px; border-radius: 8px;">
                    <h4>📊 数据预览 - ${uploadedFile.name}</h4>
                    <div style="overflow-x: auto; margin-top: 15px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 10px; border: 1px solid #ddd;">产品名称</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">销售额</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">数量</th>
                                    <th style="padding: 10px; border: 1px solid #ddd;">日期</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">笔记本电脑</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">15000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">5</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-15</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">手机</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">8000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">10</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-16</td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid #ddd;">平板电脑</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">6000</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">8</td>
                                    <td style="padding: 10px; border: 1px solid #ddd;">2024-01-17</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p style="margin-top: 15px; color: #6c757d;">
                        <strong>数据概览:</strong> 共3行数据，4个字段
                    </p>
                </div>
            `;
        }

        async function submitQuery() {
            const query = queryInput.value.trim();
            if (!query) {
                showError('请输入您的问题');
                return;
            }

            if (!fileProcessed) {
                showError('请先上传并处理Excel文件');
                return;
            }

            const loading = document.getElementById('loading');
            const responseContent = document.getElementById('responseContent');
            
            loading.classList.add('show');
            responseContent.style.display = 'none';
            queryBtn.disabled = true;

            try {
                // 模拟API调用
                const response = await simulateAnalysis(query);
                
                loading.classList.remove('show');
                responseContent.style.display = 'block';
                responseContent.textContent = response.analysis;

                // 显示生成的代码
                document.getElementById('generatedCode').innerHTML = `
                    <div style="background: white; padding: 15px; border-radius: 8px;">
                        <h4>💻 生成的Python代码</h4>
                        <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>${response.code}</code></pre>
                    </div>
                `;

                queryBtn.disabled = false;
                
            } catch (error) {
                loading.classList.remove('show');
                showError('分析失败: ' + error.message);
                queryBtn.disabled = false;
            }
        }

        async function simulateAnalysis(query) {
            // 模拟网络延迟
            await new Promise(resolve => setTimeout(resolve, 3000));

            // 模拟不同类型的回复
            let analysis = '';
            let code = '';

            if (query.includes('统计') || query.includes('基本信息')) {
                analysis = `📊 数据统计分析结果

基于您上传的Excel文件，我为您提供以下统计分析：

📋 数据概览：
• 总行数: 1,234 行
• 总列数: 8 列
• 数据类型: 4个数值列, 3个文本列, 1个日期列

📈 数值列统计：
• 销售额: 平均值 ¥8,547, 最大值 ¥25,000, 最小值 ¥1,200
• 数量: 平均值 15.6, 最大值 100, 最小值 1
• 利润率: 平均值 23.4%, 标准差 8.9%

🔍 数据质量：
• 完整性: 98.7% (16个缺失值)
• 重复记录: 3条
• 异常值: 在销售额列发现5个潜在异常值

💡 关键洞察：
1. 电子产品类别销售额占总销售额的68%
2. Q4销售额比Q3增长了15.3%
3. 周五和周六是销售高峰期

建议进一步分析产品类别分布和季节性趋势。`;

                code = `import pandas as pd
import numpy as np

# 读取数据
df = pd.read_excel('${uploadedFile.name}')

# 基本统计信息
print("数据形状:", df.shape)
print("\\n数据类型:")
print(df.dtypes)

# 数值列统计
numeric_cols = df.select_dtypes(include=[np.number]).columns
print("\\n数值列统计:")
print(df[numeric_cols].describe())

# 缺失值检查
print("\\n缺失值统计:")
print(df.isnull().sum())`;

            } else if (query.includes('异常') || query.includes('离群点')) {
                analysis = `🔍 异常值和离群点检测结果

我使用多种统计方法检测了数据中的异常值：

📊 检测方法：
1. IQR方法 (四分位距)
2. Z-Score方法 (标准化得分)
3. 隔离森林算法

🚨 发现的异常值：

销售额列 (5个异常值):
• 第67行: ¥87,500 (Z-score: 4.2)
• 第156行: ¥0 (可能是数据录入错误)
• 第234行: ¥125,000 (Z-score: 6.8)
• 第445行: ¥-2,500 (负数销售额，需要验证)
• 第789行: ¥99,999 (Z-score: 5.1)

数量列 (2个异常值):
• 第123行: 999 (可能是批发订单)
• 第567行: 0 (零数量但有销售额)

💡 建议处理方案：
1. 负数销售额: 需要数据源验证
2. 极大值: 确认是否为正常的大订单
3. 零值异常: 检查数据录入逻辑

是否需要我生成数据清洗代码？`;

                code = `import pandas as pd
import numpy as np
from scipy import stats

# 异常值检测函数
def detect_outliers_iqr(df, column):
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    
    outliers = df[(df[column] < lower_bound) | (df[column] > upper_bound)]
    return outliers

def detect_outliers_zscore(df, column, threshold=3):
    z_scores = np.abs(stats.zscore(df[column]))
    outliers = df[z_scores > threshold]
    return outliers

# 检测销售额异常值
sales_outliers_iqr = detect_outliers_iqr(df, 'sales_amount')
sales_outliers_zscore = detect_outliers_zscore(df, 'sales_amount')

print(f"IQR方法检测到 {len(sales_outliers_iqr)} 个异常值")
print(f"Z-Score方法检测到 {len(sales_outliers_zscore)} 个异常值")`;

            } else if (query.includes('关联') || query.includes('相关性')) {
                analysis = `🔗 数据关联关系分析

通过相关性分析，我发现了以下有趣的数据关联：

📈 强正相关关系 (r > 0.7):
• 销售额 ↔ 利润额: r = 0.89 (高度相关)
• 产品价格 ↔ 利润率: r = 0.76 (强相关)
• 广告投入 ↔ 销售额: r = 0.72 (强相关)

📉 负相关关系 (r < -0.3):
• 折扣率 ↔ 利润率: r = -0.65 (中度负相关)
• 库存量 ↔ 销售速度: r = -0.45 (中度负相关)

🔍 有趣的发现：
1. 销售额和利润额高度相关，说明定价策略较为稳定
2. 广告投入与销售额呈强正相关，投资回报明显
3. 折扣率过高会显著影响利润率

📊 建议：
• 优化折扣策略，平衡销量和利润
• 继续保持广告投入，ROI良好
• 关注库存周转率，减少积压

需要我生成相关性热力图吗？`;

                code = `import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# 计算相关性矩阵
numeric_cols = df.select_dtypes(include=[np.number]).columns
correlation_matrix = df[numeric_cols].corr()

# 创建热力图
plt.figure(figsize=(10, 8))
sns.heatmap(correlation_matrix, 
            annot=True, 
            cmap='coolwarm', 
            center=0,
            square=True)
plt.title('数据相关性热力图')
plt.tight_layout()
plt.show()

# 找出强相关关系
def find_high_correlations(corr_matrix, threshold=0.7):
    high_corr_pairs = []
    for i in range(len(corr_matrix.columns)):
        for j in range(i+1, len(corr_matrix.columns)):
            if abs(corr_matrix.iloc[i, j]) > threshold:
                high_corr_pairs.append({
                    'var1': corr_matrix.columns[i],
                    'var2': corr_matrix.columns[j],
                    'correlation': corr_matrix.iloc[i, j]
                })
    return high_corr_pairs

high_correlations = find_high_correlations(correlation_matrix)
print("强相关关系:")
for pair in high_correlations:
    print(f"{pair['var1']} - {pair['var2']}: {pair['correlation']:.3f}")`;

            } else if (query.includes('图表') || query.includes('可视化')) {
                analysis = `📊 数据可视化分析

我为您的数据创建了多种可视化图表：

🎨 生成的图表包括：

1. 📈 销售趋势线图
   • 显示月度销售额变化趋势
   • 发现明显的季节性模式
   • Q4销售额达到峰值

2. 📊 产品类别分布饼图
   • 电子产品: 45%
   • 服装: 28%
   • 家居: 18%
   • 其他: 9%

3. 📋 销售额分布直方图
   • 大部分订单集中在¥1,000-¥5,000区间
   • 长尾分布，少数大订单拉高了均值

4. 🔥 相关性热力图
   • 揭示了变量间的相互关系
   • 帮助理解业务驱动因素

💡 可视化洞察：
• 销售额呈现明显的季节性规律
• 产品类别分布不均匀，可考虑优化产品组合
• 大部分客户为中小额消费者

所有图表已保存到本地，您可以直接用于报告中。`;

                code = `import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
plt.rcParams['font.sans-serif'] = ['SimHei']

# 设置图表样式
plt.style.use('seaborn')

# 1. 销售趋势线图
fig, axes = plt.subplots(2, 2, figsize=(15, 12))

# 月度销售趋势
monthly_sales = df.groupby('month')['sales_amount'].sum()
axes[0,0].plot(monthly_sales.index, monthly_sales.values, marker='o')
axes[0,0].set_title('月度销售趋势')
axes[0,0].set_xlabel('月份')
axes[0,0].set_ylabel('销售额')

# 2. 产品类别分布饼图
category_dist = df['category'].value_counts()
axes[0,1].pie(category_dist.values, labels=category_dist.index, autopct='%1.1f%%')
axes[0,1].set_title('产品类别分布')

# 3. 销售额分布直方图
axes[1,0].hist(df['sales_amount'], bins=30, alpha=0.7)
axes[1,0].set_title('销售额分布')
axes[1,0].set_xlabel('销售额')
axes[1,0].set_ylabel('频次')

# 4. 相关性热力图
corr = df.select_dtypes(include=[np.number]).corr()
sns.heatmap(corr, annot=True, cmap='coolwarm', ax=axes[1,1])
axes[1,1].set_title('相关性热力图')

plt.tight_layout()
plt.savefig('数据分析图表.png', dpi=300, bbox_inches='tight')
plt.show()`;

            } else {
                analysis = `🤖 AI智能分析回复

感谢您的提问！基于您上传的Excel文件，我为您提供以下分析：

📊 数据概况：
您的文件包含 ${uploadedFile.name}，我已经完成了初步的数据解析和结构分析。

🔍 针对您的问题："${query}"

我建议从以下几个角度进行分析：

1. 📈 数据统计：基本的描述性统计信息
2. 🔍 数据质量：检查缺失值、重复值、异常值
3. 📊 数据分布：了解各字段的分布特征
4. 🔗 关联分析：探索变量间的相关关系
5. 🎯 业务洞察：结合业务背景提供建议

💡 如需更具体的分析，请尝试以下问题：
• "帮我分析数据的基本统计信息"
• "检测数据中的异常值"
• "分析各列之间的相关性"
• "生成数据可视化图表"

我随时准备为您提供更详细的分析！`;

                code = `import pandas as pd
import numpy as np

# 读取Excel文件
df = pd.read_excel('${uploadedFile.name}')

# 基本信息查看
print("数据基本信息:")
print(f"行数: {df.shape[0]}")
print(f"列数: {df.shape[1]}")
print(f"\\n列名: {list(df.columns)}")

# 数据类型
print("\\n数据类型:")
print(df.dtypes)

# 前5行数据预览
print("\\n数据预览:")
print(df.head())

# 可以继续添加更多分析...`;
            }

            return { analysis, code };
        }

        function setQuery(query) {
            document.getElementById('queryInput').value = query;
        }

        function switchTab(tabName) {
            // 隐藏所有标签内容
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 移除所有标签的active状态
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // 显示选中的标签内容
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // 设置选中标签的active状态
            event.target.classList.add('active');
        }

        function showError(message) {
            const responseContent = document.getElementById('responseContent');
            responseContent.innerHTML = `<div class="error">❌ ${message}</div>`;
            responseContent.style.display = 'block';
        }

        function showSuccess(message) {
            const responseContent = document.getElementById('responseContent');
            responseContent.innerHTML = `<div class="success">✅ ${message}</div>`;
            responseContent.style.display = 'block';
        }
    </script>
</body>
</html>